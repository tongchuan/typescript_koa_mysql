<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Koa API Management Interface</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #333;
            text-align: center;
        }
        .section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .section h2 {
            margin-top: 0;
            color: #444;
        }
        .form-group {
            margin-bottom: 15px;
        }
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        input, textarea, select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-sizing: border-box;
        }
        button {
            background-color: #007cba;
            color: white;
            padding: 10px 15px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
        }
        button:hover {
            background-color: #005a87;
        }
        button.delete {
            background-color: #d9534f;
        }
        button.delete:hover {
            background-color: #c9302c;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        th, td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        th {
            background-color: #f2f2f2;
        }
        .message {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .success {
            background-color: #dff0d8;
            color: #3c763d;
            border: 1px solid #d6e9c6;
        }
        .error {
            background-color: #f2dede;
            color: #a94442;
            border: 1px solid #ebccd1;
        }
        .pagination {
            margin-top: 15px;
            text-align: center;
        }
        .pagination button {
            margin: 0 5px;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Koa API Management Interface</h1>
        
        <div id="message-area"></div>
        
        <!-- News Section -->
        <div class="section" id="news-section">
            <h2>News Management</h2>
            
            <div class="form-group">
                <label>Search News:</label>
                <input type="text" id="news-search" placeholder="Enter search term">
                <button onclick="searchNews()">Search</button>
            </div>
            
            <form id="news-form">
                <div class="form-group">
                    <label for="news-title">Title:</label>
                    <input type="text" id="news-title" required>
                </div>
                <div class="form-group">
                    <label for="news-content">Content:</label>
                    <textarea id="news-content" rows="4" required></textarea>
                </div>
                <div class="form-group">
                    <label for="news-category">Category ID (optional):</label>
                    <input type="number" id="news-category">
                </div>
                <input type="hidden" id="news-id">
                <button type="submit">Add News</button>
                <button type="button" id="news-update-btn" class="hidden" onclick="updateNews()">Update News</button>
                <button type="button" onclick="cancelEdit()">Cancel</button>
            </form>
            
            <div id="news-list"></div>
            <div id="news-pagination" class="pagination"></div>
        </div>
        
        <!-- Products Section -->
        <div class="section" id="products-section">
            <h2>Products Management</h2>
            
            <div class="form-group">
                <label>Search Products:</label>
                <input type="text" id="product-search" placeholder="Enter search term">
                <button onclick="searchProducts()">Search</button>
            </div>
            
            <form id="product-form">
                <div class="form-group">
                    <label for="product-name">Name:</label>
                    <input type="text" id="product-name" required>
                </div>
                <div class="form-group">
                    <label for="product-description">Description:</label>
                    <textarea id="product-description" rows="3"></textarea>
                </div>
                <div class="form-group">
                    <label for="product-price">Price:</label>
                    <input type="number" id="product-price" step="0.01" required>
                </div>
                <div class="form-group">
                    <label for="product-stock">Stock Quantity:</label>
                    <input type="number" id="product-stock" value="0">
                </div>
                <input type="hidden" id="product-id">
                <button type="submit">Add Product</button>
                <button type="button" id="product-update-btn" class="hidden" onclick="updateProduct()">Update Product</button>
                <button type="button" onclick="cancelEdit()">Cancel</button>
            </form>
            
            <div id="product-list"></div>
            <div id="product-pagination" class="pagination"></div>
        </div>
        
        <!-- Categories Section -->
        <div class="section" id="categories-section">
            <h2>Categories Management</h2>
            
            <div class="form-group">
                <label>Search Categories:</label>
                <input type="text" id="category-search" placeholder="Enter search term">
                <button onclick="searchCategories()">Search</button>
            </div>
            
            <form id="category-form">
                <div class="form-group">
                    <label for="category-name">Name:</label>
                    <input type="text" id="category-name" required>
                </div>
                <div class="form-group">
                    <label for="category-description">Description:</label>
                    <textarea id="category-description" rows="3"></textarea>
                </div>
                <input type="hidden" id="category-id">
                <button type="submit">Add Category</button>
                <button type="button" id="category-update-btn" class="hidden" onclick="updateCategory()">Update Category</button>
                <button type="button" onclick="cancelEdit()">Cancel</button>
            </form>
            
            <div id="category-list"></div>
            <div id="category-pagination" class="pagination"></div>
        </div>
        
        <!-- Messages Section -->
        <div class="section" id="messages-section">
            <h2>Messages Management</h2>
            
            <div class="form-group">
                <label>Filter Messages by Status:</label>
                <select id="message-status-filter">
                    <option value="">All</option>
                    <option value="pending">Pending</option>
                    <option value="read">Read</option>
                    <option value="archived">Archived</option>
                </select>
                <button onclick="searchMessages()">Filter</button>
            </div>
            
            <form id="message-form">
                <div class="form-group">
                    <label for="message-name">Name:</label>
                    <input type="text" id="message-name" required>
                </div>
                <div class="form-group">
                    <label for="message-email">Email:</label>
                    <input type="email" id="message-email">
                </div>
                <div class="form-group">
                    <label for="message-content">Content:</label>
                    <textarea id="message-content" rows="4" required></textarea>
                </div>
                <input type="hidden" id="message-id">
                <button type="submit">Add Message</button>
            </form>
            
            <div id="message-list"></div>
            <div id="message-pagination" class="pagination"></div>
        </div>
    </div>

    <script>
        // Global variables for pagination
        let currentNewsPage = 1;
        let currentProductPage = 1;
        let currentCategoryPage = 1;
        let currentMessagePage = 1;
        
        // Current editing item
        let currentEditType = null;
        let currentEditId = null;
        
        // Initialize the page
        document.addEventListener('DOMContentLoaded', function() {
            loadNews(1);
            loadProducts(1);
            loadCategories(1);
            loadMessages(1);
            
            // Set up form submissions
            document.getElementById('news-form').addEventListener('submit', submitNews);
            document.getElementById('product-form').addEventListener('submit', submitProduct);
            document.getElementById('category-form').addEventListener('submit', submitCategory);
            document.getElementById('message-form').addEventListener('submit', submitMessage);
        });
        
        // Show message in message area
        function showMessage(message, type = 'success') {
            const messageArea = document.getElementById('message-area');
            messageArea.innerHTML = `<div class="message ${type}">${message}</div>`;
            
            // Auto hide message after 5 seconds
            setTimeout(() => {
                messageArea.innerHTML = '';
            }, 5000);
        }
        
        // NEWS MANAGEMENT
        async function loadNews(page = 1) {
            currentNewsPage = page;
            try {
                const response = await fetch(`/api/news?page=${page}&limit=5`);
                const data = await response.json();
                
                if (response.ok) {
                    displayNews(data.data);
                    renderPagination('news', data.pagination, loadNews);
                } else {
                    showMessage(`Error loading news: ${data.error}`, 'error');
                }
            } catch (error) {
                showMessage(`Error loading news: ${error.message}`, 'error');
            }
        }
        
        function displayNews(news) {
            const newsList = document.getElementById('news-list');
            newsList.innerHTML = `
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Title</th>
                            <th>Content</th>
                            <th>Category ID</th>
                            <th>Created At</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${news.map(item => `
                            <tr>
                                <td>${item.id}</td>
                                <td>${item.title}</td>
                                <td>${item.content.substring(0, 50)}${item.content.length > 50 ? '...' : ''}</td>
                                <td>${item.category_id || 'N/A'}</td>
                                <td>${new Date(item.created_at).toLocaleString()}</td>
                                <td>
                                    <button onclick="editNews(${item.id})">Edit</button>
                                    <button class="delete" onclick="deleteNews(${item.id})">Delete</button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }
        
        async function submitNews(e) {
            e.preventDefault();
            
            const title = document.getElementById('news-title').value;
            const content = document.getElementById('news-content').value;
            const categoryId = document.getElementById('news-category').value || null;
            
            const newsData = {
                title,
                content,
                category_id: categoryId ? parseInt(categoryId) : null
            };
            
            try {
                const response = await fetch('/api/news', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(newsData)
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    showMessage('News item created successfully');
                    document.getElementById('news-form').reset();
                    loadNews(currentNewsPage);
                } else {
                    showMessage(`Error creating news: ${result.error}`, 'error');
                }
            } catch (error) {
                showMessage(`Error creating news: ${error.message}`, 'error');
            }
        }
        
        async function updateNews() {
            const id = document.getElementById('news-id').value;
            const title = document.getElementById('news-title').value;
            const content = document.getElementById('news-content').value;
            const categoryId = document.getElementById('news-category').value || null;
            
            const newsData = {
                title,
                content,
                category_id: categoryId ? parseInt(categoryId) : null
            };
            
            try {
                const response = await fetch(`/api/news/${id}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(newsData)
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    showMessage('News item updated successfully');
                    document.getElementById('news-form').reset();
                    document.getElementById('news-update-btn').classList.add('hidden');
                    document.getElementById('news-form').querySelector('button[type="submit"]').style.display = 'inline-block';
                    loadNews(currentNewsPage);
                } else {
                    showMessage(`Error updating news: ${result.error}`, 'error');
                }
            } catch (error) {
                showMessage(`Error updating news: ${error.message}`, 'error');
            }
        }
        
        async function editNews(id) {
            try {
                const response = await fetch(`/api/news/${id}`);
                const news = await response.json();
                
                if (response.ok) {
                    document.getElementById('news-id').value = news.id;
                    document.getElementById('news-title').value = news.title;
                    document.getElementById('news-content').value = news.content;
                    document.getElementById('news-category').value = news.category_id || '';
                    
                    // Show update button and hide submit button
                    document.getElementById('news-update-btn').classList.remove('hidden');
                    document.getElementById('news-form').querySelector('button[type="submit"]').style.display = 'none';
                    
                    // Scroll to form
                    document.getElementById('news-form').scrollIntoView({ behavior: 'smooth' });
                } else {
                    showMessage(`Error loading news: ${news.error}`, 'error');
                }
            } catch (error) {
                showMessage(`Error loading news: ${error.message}`, 'error');
            }
        }
        
        async function deleteNews(id) {
            if (confirm('Are you sure you want to delete this news item?')) {
                try {
                    const response = await fetch(`/api/news/${id}`, {
                        method: 'DELETE'
                    });
                    
                    if (response.ok) {
                        showMessage('News item deleted successfully');
                        loadNews(currentNewsPage);
                    } else {
                        const result = await response.json();
                        showMessage(`Error deleting news: ${result.error}`, 'error');
                    }
                } catch (error) {
                    showMessage(`Error deleting news: ${error.message}`, 'error');
                }
            }
        }
        
        async function searchNews() {
            const searchTerm = document.getElementById('news-search').value;
            try {
                const response = await fetch(`/api/news?page=1&limit=5&search=${encodeURIComponent(searchTerm)}`);
                const data = await response.json();
                
                if (response.ok) {
                    displayNews(data.data);
                    // For simplicity, we're not showing pagination for search results
                    document.getElementById('news-pagination').innerHTML = '';
                } else {
                    showMessage(`Error searching news: ${data.error}`, 'error');
                }
            } catch (error) {
                showMessage(`Error searching news: ${error.message}`, 'error');
            }
        }
        
        // PRODUCTS MANAGEMENT
        async function loadProducts(page = 1) {
            currentProductPage = page;
            try {
                const response = await fetch(`/api/products?page=${page}&limit=5`);
                const data = await response.json();
                
                if (response.ok) {
                    displayProducts(data.data);
                    renderPagination('product', data.pagination, loadProducts);
                } else {
                    showMessage(`Error loading products: ${data.error}`, 'error');
                }
            } catch (error) {
                showMessage(`Error loading products: ${error.message}`, 'error');
            }
        }
        
        function displayProducts(products) {
            const productList = document.getElementById('product-list');
            productList.innerHTML = `
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Name</th>
                            <th>Description</th>
                            <th>Price</th>
                            <th>Stock</th>
                            <th>Created At</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${products.map(item => `
                            <tr>
                                <td>${item.id}</td>
                                <td>${item.name}</td>
                                <td>${item.description ? item.description.substring(0, 50) + (item.description.length > 50 ? '...' : '') : ''}</td>
                                <td>$${item.price}</td>
                                <td>${item.stock_quantity}</td>
                                <td>${new Date(item.created_at).toLocaleString()}</td>
                                <td>
                                    <button onclick="editProduct(${item.id})">Edit</button>
                                    <button class="delete" onclick="deleteProduct(${item.id})">Delete</button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }
        
        async function submitProduct(e) {
            e.preventDefault();
            
            const name = document.getElementById('product-name').value;
            const description = document.getElementById('product-description').value;
            const price = parseFloat(document.getElementById('product-price').value);
            const stock = parseInt(document.getElementById('product-stock').value) || 0;
            
            const productData = {
                name,
                description,
                price,
                stock_quantity: stock
            };
            
            try {
                const response = await fetch('/api/products', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(productData)
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    showMessage('Product created successfully');
                    document.getElementById('product-form').reset();
                    loadProducts(currentProductPage);
                } else {
                    showMessage(`Error creating product: ${result.error}`, 'error');
                }
            } catch (error) {
                showMessage(`Error creating product: ${error.message}`, 'error');
            }
        }
        
        async function updateProduct() {
            const id = document.getElementById('product-id').value;
            const name = document.getElementById('product-name').value;
            const description = document.getElementById('product-description').value;
            const price = parseFloat(document.getElementById('product-price').value);
            const stock = parseInt(document.getElementById('product-stock').value) || 0;
            
            const productData = {
                name,
                description,
                price,
                stock_quantity: stock
            };
            
            try {
                const response = await fetch(`/api/products/${id}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(productData)
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    showMessage('Product updated successfully');
                    document.getElementById('product-form').reset();
                    document.getElementById('product-update-btn').classList.add('hidden');
                    document.getElementById('product-form').querySelector('button[type="submit"]').style.display = 'inline-block';
                    loadProducts(currentProductPage);
                } else {
                    showMessage(`Error updating product: ${result.error}`, 'error');
                }
            } catch (error) {
                showMessage(`Error updating product: ${error.message}`, 'error');
            }
        }
        
        async function editProduct(id) {
            try {
                const response = await fetch(`/api/products/${id}`);
                const product = await response.json();
                
                if (response.ok) {
                    document.getElementById('product-id').value = product.id;
                    document.getElementById('product-name').value = product.name;
                    document.getElementById('product-description').value = product.description || '';
                    document.getElementById('product-price').value = product.price;
                    document.getElementById('product-stock').value = product.stock_quantity;
                    
                    // Show update button and hide submit button
                    document.getElementById('product-update-btn').classList.remove('hidden');
                    document.getElementById('product-form').querySelector('button[type="submit"]').style.display = 'none';
                    
                    // Scroll to form
                    document.getElementById('product-form').scrollIntoView({ behavior: 'smooth' });
                } else {
                    showMessage(`Error loading product: ${product.error}`, 'error');
                }
            } catch (error) {
                showMessage(`Error loading product: ${error.message}`, 'error');
            }
        }
        
        async function deleteProduct(id) {
            if (confirm('Are you sure you want to delete this product?')) {
                try {
                    const response = await fetch(`/api/products/${id}`, {
                        method: 'DELETE'
                    });
                    
                    if (response.ok) {
                        showMessage('Product deleted successfully');
                        loadProducts(currentProductPage);
                    } else {
                        const result = await response.json();
                        showMessage(`Error deleting product: ${result.error}`, 'error');
                    }
                } catch (error) {
                    showMessage(`Error deleting product: ${error.message}`, 'error');
                }
            }
        }
        
        async function searchProducts() {
            const searchTerm = document.getElementById('product-search').value;
            try {
                const response = await fetch(`/api/products?page=1&limit=5&search=${encodeURIComponent(searchTerm)}`);
                const data = await response.json();
                
                if (response.ok) {
                    displayProducts(data.data);
                    // For simplicity, we're not showing pagination for search results
                    document.getElementById('product-pagination').innerHTML = '';
                } else {
                    showMessage(`Error searching products: ${data.error}`, 'error');
                }
            } catch (error) {
                showMessage(`Error searching products: ${error.message}`, 'error');
            }
        }
        
        // CATEGORIES MANAGEMENT
        async function loadCategories(page = 1) {
            currentCategoryPage = page;
            try {
                const response = await fetch(`/api/categories?page=${page}&limit=5`);
                const data = await response.json();
                
                if (response.ok) {
                    displayCategories(data.data);
                    renderPagination('category', data.pagination, loadCategories);
                } else {
                    showMessage(`Error loading categories: ${data.error}`, 'error');
                }
            } catch (error) {
                showMessage(`Error loading categories: ${error.message}`, 'error');
            }
        }
        
        function displayCategories(categories) {
            const categoryList = document.getElementById('category-list');
            categoryList.innerHTML = `
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Name</th>
                            <th>Description</th>
                            <th>Created At</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${categories.map(item => `
                            <tr>
                                <td>${item.id}</td>
                                <td>${item.name}</td>
                                <td>${item.description ? item.description.substring(0, 50) + (item.description.length > 50 ? '...' : '') : ''}</td>
                                <td>${new Date(item.created_at).toLocaleString()}</td>
                                <td>
                                    <button onclick="editCategory(${item.id})">Edit</button>
                                    <button class="delete" onclick="deleteCategory(${item.id})">Delete</button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }
        
        async function submitCategory(e) {
            e.preventDefault();
            
            const name = document.getElementById('category-name').value;
            const description = document.getElementById('category-description').value;
            
            const categoryData = {
                name,
                description
            };
            
            try {
                const response = await fetch('/api/categories', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(categoryData)
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    showMessage('Category created successfully');
                    document.getElementById('category-form').reset();
                    loadCategories(currentCategoryPage);
                } else {
                    showMessage(`Error creating category: ${result.error}`, 'error');
                }
            } catch (error) {
                showMessage(`Error creating category: ${error.message}`, 'error');
            }
        }
        
        async function updateCategory() {
            const id = document.getElementById('category-id').value;
            const name = document.getElementById('category-name').value;
            const description = document.getElementById('category-description').value;
            
            const categoryData = {
                name,
                description
            };
            
            try {
                const response = await fetch(`/api/categories/${id}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(categoryData)
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    showMessage('Category updated successfully');
                    document.getElementById('category-form').reset();
                    document.getElementById('category-update-btn').classList.add('hidden');
                    document.getElementById('category-form').querySelector('button[type="submit"]').style.display = 'inline-block';
                    loadCategories(currentCategoryPage);
                } else {
                    showMessage(`Error updating category: ${result.error}`, 'error');
                }
            } catch (error) {
                showMessage(`Error updating category: ${error.message}`, 'error');
            }
        }
        
        async function editCategory(id) {
            try {
                const response = await fetch(`/api/categories/${id}`);
                const category = await response.json();
                
                if (response.ok) {
                    document.getElementById('category-id').value = category.id;
                    document.getElementById('category-name').value = category.name;
                    document.getElementById('category-description').value = category.description || '';
                    
                    // Show update button and hide submit button
                    document.getElementById('category-update-btn').classList.remove('hidden');
                    document.getElementById('category-form').querySelector('button[type="submit"]').style.display = 'none';
                    
                    // Scroll to form
                    document.getElementById('category-form').scrollIntoView({ behavior: 'smooth' });
                } else {
                    showMessage(`Error loading category: ${category.error}`, 'error');
                }
            } catch (error) {
                showMessage(`Error loading category: ${error.message}`, 'error');
            }
        }
        
        async function deleteCategory(id) {
            if (confirm('Are you sure you want to delete this category?')) {
                try {
                    const response = await fetch(`/api/categories/${id}`, {
                        method: 'DELETE'
                    });
                    
                    if (response.ok) {
                        showMessage('Category deleted successfully');
                        loadCategories(currentCategoryPage);
                    } else {
                        const result = await response.json();
                        showMessage(`Error deleting category: ${result.error}`, 'error');
                    }
                } catch (error) {
                    showMessage(`Error deleting category: ${error.message}`, 'error');
                }
            }
        }
        
        async function searchCategories() {
            const searchTerm = document.getElementById('category-search').value;
            try {
                const response = await fetch(`/api/categories?page=1&limit=5&search=${encodeURIComponent(searchTerm)}`);
                const data = await response.json();
                
                if (response.ok) {
                    displayCategories(data.data);
                    // For simplicity, we're not showing pagination for search results
                    document.getElementById('category-pagination').innerHTML = '';
                } else {
                    showMessage(`Error searching categories: ${data.error}`, 'error');
                }
            } catch (error) {
                showMessage(`Error searching categories: ${error.message}`, 'error');
            }
        }
        
        // MESSAGES MANAGEMENT
        async function loadMessages(page = 1) {
            currentMessagePage = page;
            try {
                const response = await fetch(`/api/messages?page=${page}&limit=5`);
                const data = await response.json();
                
                if (response.ok) {
                    displayMessages(data.data);
                    renderPagination('message', data.pagination, loadMessages);
                } else {
                    showMessage(`Error loading messages: ${data.error}`, 'error');
                }
            } catch (error) {
                showMessage(`Error loading messages: ${error.message}`, 'error');
            }
        }
        
        function displayMessages(messages) {
            const messageList = document.getElementById('message-list');
            messageList.innerHTML = `
                <table>
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Name</th>
                            <th>Email</th>
                            <th>Content</th>
                            <th>Status</th>
                            <th>Created At</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${messages.map(item => `
                            <tr>
                                <td>${item.id}</td>
                                <td>${item.name}</td>
                                <td>${item.email || 'N/A'}</td>
                                <td>${item.content.substring(0, 50)}${item.content.length > 50 ? '...' : ''}</td>
                                <td>${item.status}</td>
                                <td>${new Date(item.created_at).toLocaleString()}</td>
                                <td>
                                    <button onclick="updateMessageStatus(${item.id}, 'read')">Mark Read</button>
                                    <button class="delete" onclick="deleteMessage(${item.id})">Delete</button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
        }
        
        async function submitMessage(e) {
            e.preventDefault();
            
            const name = document.getElementById('message-name').value;
            const email = document.getElementById('message-email').value;
            const content = document.getElementById('message-content').value;
            
            const messageData = {
                name,
                email,
                content
            };
            
            try {
                const response = await fetch('/api/messages', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(messageData)
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    showMessage('Message created successfully');
                    document.getElementById('message-form').reset();
                    loadMessages(currentMessagePage);
                } else {
                    showMessage(`Error creating message: ${result.error}`, 'error');
                }
            } catch (error) {
                showMessage(`Error creating message: ${error.message}`, 'error');
            }
        }
        
        async function updateMessageStatus(id, status) {
            try {
                const response = await fetch(`/api/messages/${id}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ status })
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    showMessage('Message status updated successfully');
                    loadMessages(currentMessagePage);
                } else {
                    showMessage(`Error updating message: ${result.error}`, 'error');
                }
            } catch (error) {
                showMessage(`Error updating message: ${error.message}`, 'error');
            }
        }
        
        async function deleteMessage(id) {
            if (confirm('Are you sure you want to delete this message?')) {
                try {
                    const response = await fetch(`/api/messages/${id}`, {
                        method: 'DELETE'
                    });
                    
                    if (response.ok) {
                        showMessage('Message deleted successfully');
                        loadMessages(currentMessagePage);
                    } else {
                        const result = await response.json();
                        showMessage(`Error deleting message: ${result.error}`, 'error');
                    }
                } catch (error) {
                    showMessage(`Error deleting message: ${error.message}`, 'error');
                }
            }
        }
        
        async function searchMessages() {
            const status = document.getElementById('message-status-filter').value;
            try {
                const url = status ? `/api/messages?page=1&limit=5&status=${status}` : `/api/messages?page=1&limit=5`;
                const response = await fetch(url);
                const data = await response.json();
                
                if (response.ok) {
                    displayMessages(data.data);
                    // For simplicity, we're not showing pagination for filter results
                    document.getElementById('message-pagination').innerHTML = '';
                } else {
                    showMessage(`Error filtering messages: ${data.error}`, 'error');
                }
            } catch (error) {
                showMessage(`Error filtering messages: ${error.message}`, 'error');
            }
        }
        
        // Utility functions
        function renderPagination(type, pagination, loadFunction) {
            const paginationElement = document.getElementById(`${type}-pagination`);
            
            if (pagination.totalPages <= 1) {
                paginationElement.innerHTML = '';
                return;
            }
            
            let html = '';
            
            // Previous button
            if (pagination.page > 1) {
                html += `<button onclick="${loadFunction.name}(${pagination.page - 1})">Previous</button>`;
            }
            
            // Page numbers
            for (let i = 1; i <= pagination.totalPages; i++) {
                if (i === pagination.page) {
                    html += `<button style="background-color: #007cba; color: white;" disabled>${i}</button>`;
                } else {
                    html += `<button onclick="${loadFunction.name}(${i})">${i}</button>`;
                }
            }
            
            // Next button
            if (pagination.page < pagination.totalPages) {
                html += `<button onclick="${loadFunction.name}(${pagination.page + 1})">Next</button>`;
            }
            
            paginationElement.innerHTML = html;
        }
        
        function cancelEdit() {
            // Reset all forms
            document.getElementById('news-form').reset();
            document.getElementById('product-form').reset();
            document.getElementById('category-form').reset();
            document.getElementById('message-form').reset();
            
            // Hide update buttons and show submit buttons
            document.getElementById('news-update-btn').classList.add('hidden');
            document.getElementById('product-update-btn').classList.add('hidden');
            document.getElementById('category-update-btn').classList.add('hidden');
            
            document.getElementById('news-form').querySelector('button[type="submit"]').style.display = 'inline-block';
            document.getElementById('product-form').querySelector('button[type="submit"]').style.display = 'inline-block';
            document.getElementById('category-form').querySelector('button[type="submit"]').style.display = 'inline-block';
        }
    </script>
</body>
</html>